<%- include('./partials/head.ejs') %>
<%- include('./partials/nav.ejs') %>
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
    <div>
        <form action="/fnsh" method="POST">
            <div class="mt-5 d-flex justify-content-between p-2">
                <div class="row align-items-end">
                    <div class="col">
                        <label class="form-label">Placa: </label>
                        <input name="inputplaca" value="<%= placa %>" class="form-control" type="text" required />
                    </div>
                    <div class="col">
                        <a id="addCort" class="btn btn-warning" onclick="addCortesia()">Adicionar Cortesia</a>
                        <a id="rmCort" class="btn btn-warning d-none" onclick="rmCortesia()">Retirar Cortesia</a>
                    </div>
                    <input class="d-none" id="cortesia" name="cortesia" type="text" value="Cortesia" disabled />
                </div>
                <div>
                    <label class="form-label p-2" style="font-weight: bold; font-size: 50px;">Total:</label>
                    <label id="total" class="p-2" style="font-weight: bold; font-size: 50px;"><%= valor %></label>
                </div>
            </div>
            <div>
                <h4 id="warning" class="text-center d-none p-2" style="color: red;">Atenção: Você está adicionando uma cortesia para esse cliente!</h4>
            </div>
            <div class="mt-3 row justify-content-center">
                <div class="col-2 mt-2">
                    <label class="form-label">Entrada</label>
                    <input name="inputenter" class="form-control" value="<%= info[0].entrada.toString().substring(15, 24) %>" type="text" required/>
                </div>
                <div class="col-2 mt-2">
                    <label class="form-label">Saída</label>
                    <input name="inputexit" class="form-control" value="<%= info[0].now.substring(0,8) %>" type="text" required/>
                </div>
                <div class="col-2 mt-2">
                    <label class="form-label">Estadia</label>
                    <input name="inputestadia" class="form-control" value="<%= dif %>" type="text" required/>
                </div>
                <div class="col-2 mt-2">
                    <label class="form-label">Valor a ser pago: </label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input id="preco" name="inputpay" class="form-control" value="<%= valor %>" onkeypress="$(this).mask('#.##0,00', {reverse: true})" type="text" required/>
                    </div>
                    <div class="d-none">
                        <span class="input-group-text">$</span>
                        <input id="precoT" name="inputpayT" class="form-control" value="<%= valor %>" type="text" required/>
                    </div>
                </div>
                <div class="col-2 mt-2">
                    <label class="form-label">Desconto: </label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input id="desconto" name="inputdesc" class="form-control" value="0,00" onkeypress="$(this).mask('#.##0,00', {reverse: true})" type="text"/>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-end">
                
            </div>
            <div class="row mt-5 mx-auto w-50">
                <a href="/" class="btn btn-outline-primary mb-3">Voltar</a>
                <button type="submit" class="btn btn-success">Finalizar</button>
            </div>
        </form>
    </div>
</main>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
<script>
    var preco = document.getElementById('preco')
    var desconto = document.getElementById('desconto')
    var precoT = document.getElementById('precoT')

    console.log(parseFloat(preco.value))
    console.log(parseFloat(desconto.value))

    function addCortesia(){
        var cortesia = document.getElementById('cortesia')
        cortesia.disabled = false
        document.getElementById('addCort').classList.add('d-none')
        document.getElementById('rmCort').classList.remove('d-none')
        document.getElementById('warning').classList.remove('d-none')
        document.getElementById('desconto').value = '<%= valor %>'
        document.getElementById('total').innerHTML = '0,00'
    }

    function rmCortesia(){
        document.getElementById('cortesia').disabled = true
        document.getElementById('addCort').classList.remove('d-none')
        document.getElementById('rmCort').classList.add('d-none')
        document.getElementById('warning').classList.add('d-none')
        document.getElementById('desconto').value = '0,00'
        document.getElementById('total').innerHTML = '<%= valor %>'
    }

    preco.addEventListener('keyup', () =>{
        var total = parseFloat(preco.value.replace(',', '.')) - parseFloat(desconto.value.replace(',', '.'))
        document.getElementById('total').innerText = total.toString().includes('.') == true ? total.toFixed(2).toString().replace('.', ',') : total + ',00'
        precoT.value = total.toString().includes('.') == true ? total.toFixed(2).toString().replace('.', ',') : total + ',00'
    })

    desconto.addEventListener('keyup', () => {
        var total = parseFloat(preco.value.replace(',', '.')) - parseFloat(desconto.value.replace(',', '.'))
        document.getElementById('total').innerText = total.toString().includes('.') == true ? total.toFixed(2).toString().replace('.', ',') : total + ',00'
        precoT.value = total.toString().includes('.') == true ? total.toFixed(2).toString().replace('.', ',') : total + ',00'
    })
</script>